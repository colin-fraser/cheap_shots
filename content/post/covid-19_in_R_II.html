---
title: "COVID-19 and R Part II"
author: "Drew Tyre"
date: '2020-03-13'
output: 
  html_document:
    code_folding: hide
draft: yes
slug: COVID-19_and_R_II
tags_include:
- R
- OPD
categories: Research
---



<p>Yesterday I got into <a href="post/covid-19_in_R.html">the COVID-19 forecasting business</a>.
Today I want to see how my predictions held up.</p>
<div id="munging-the-data-again" class="section level1">
<h1>Munging the data … again</h1>
<p>My least favorite part of data analysis is munging the data into a usable form.
Especially #otherpeoplesdata. John Hopkins University is doing a great service
making their data under their COVID-19 dashboard open, but they’ve made some
interesting choices. I can only assume these choices work well for what they are
doing; certainly isn’t making my work easier! From the issues posted on github
sounds like the JHU team might be getting overwhelmed. As of this writing,
the data are not available from JHU for March 12 and 13. I got <a href="https://www.cdc.gov/coronavirus/2019-ncov/cases-in-us.html#investigation">cumulative cases
for the whole USA from the CDC website</a>,
with the help of the <a href="">wayback machine internet archive</a>. Actually that doesn’t
work either because the cdc numbers are different going back to March 8 at least.</p>
<pre class="r"><code>library(&quot;tidyverse&quot;)</code></pre>
<pre><code>## ── Attaching packages ───────────────────────────────────────────────────────────────── tidyverse 1.2.1 ──</code></pre>
<pre><code>## ✔ ggplot2 3.2.0     ✔ purrr   0.3.2
## ✔ tibble  2.1.3     ✔ dplyr   0.8.3
## ✔ tidyr   1.0.2     ✔ stringr 1.4.0
## ✔ readr   1.3.1     ✔ forcats 0.4.0</code></pre>
<pre><code>## ── Conflicts ──────────────────────────────────────────────────────────────────── tidyverse_conflicts() ──
## ✖ dplyr::filter() masks stats::filter()
## ✖ dplyr::lag()    masks stats::lag()</code></pre>
<pre class="r"><code>library(&quot;lubridate&quot;)</code></pre>
<pre><code>## 
## Attaching package: &#39;lubridate&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:base&#39;:
## 
##     date</code></pre>
<pre class="r"><code>jhu_url &lt;- paste(&quot;https://raw.githubusercontent.com/CSSEGISandData/&quot;, 
                 &quot;COVID-19/master/csse_covid_19_data/&quot;, 
                 &quot;csse_covid_19_time_series/&quot;, 
                 &quot;time_series_19-covid-Confirmed.csv&quot;, sep = &quot;&quot;)

jhu_wide &lt;- read_csv(jhu_url) # just grab it once from github</code></pre>
<pre><code>## Parsed with column specification:
## cols(
##   .default = col_double(),
##   `Province/State` = col_character(),
##   `Country/Region` = col_character(),
##   `3/13/20` = col_logical()
## )</code></pre>
<pre><code>## See spec(...) for full column specifications.</code></pre>
<pre class="r"><code>us_confirmed_total &lt;- jhu_wide %&gt;% 
  rename(province = &quot;Province/State&quot;, 
         country_region = &quot;Country/Region&quot;) %&gt;% 
  pivot_longer(-c(province, country_region, Lat, Long), 
               names_to = &quot;Date&quot;, values_to = &quot;cumulative_cases&quot;) %&gt;% 
  # adjust JHU dates back one day to reflect US time, more or
  # less
  mutate(Date = lubridate::mdy(Date) - lubridate::days(1)) %&gt;% 
  filter(country_region == &quot;US&quot;) %&gt;% 
  arrange(province, Date)  %&gt;% 
  # up to here, no problem. same as before.
  # solution? filter out state rows prior to march 8, and county rows after that. 
  filter(str_detect(province, &quot;, &quot;) &amp; Date &lt;= &quot;2020-03-8&quot; |
           str_detect(province, &quot;, &quot;, negate = TRUE) &amp; Date &gt; &quot;2020-03-8&quot;) %&gt;% 
  group_by(Date) %&gt;% # then group by Date and sum
  summarize(cumulative_cases = sum(cumulative_cases)) 
# manually add in march 12 and 13
bind_rows(us_confirmed_total[1:51,], 
          tibble(Date = ymd(c(&quot;2020-03-12&quot;,&quot;2020-03-13&quot;)),
                 cumulative_cases = c(1215, 1629)))</code></pre>
<pre><code>## # A tibble: 53 x 2
##    Date       cumulative_cases
##    &lt;date&gt;                &lt;dbl&gt;
##  1 2020-01-21                1
##  2 2020-01-22                1
##  3 2020-01-23                2
##  4 2020-01-24                2
##  5 2020-01-25                5
##  6 2020-01-26                5
##  7 2020-01-27                5
##  8 2020-01-28                5
##  9 2020-01-29                5
## 10 2020-01-30                7
## # … with 43 more rows</code></pre>
<pre class="r"><code>us_confirmed_total &lt;- us_confirmed_total %&gt;% 
  ungroup() %&gt;% 
  mutate(incident_cases = c(0, diff(cumulative_cases)))
p1 &lt;- ggplot(data = filter(us_confirmed_total, Date &gt; &quot;2020-02-27&quot;, Date &lt;= &quot;2020-03-11&quot;),
       mapping = aes(x = Date)) + 
#  geom_line(mapping = aes(y = incident_cases)) + 
  geom_point(mapping = aes(y = incident_cases)) + 
  scale_y_log10() + 
  geom_smooth(mapping = aes(y = incident_cases), method = &quot;lm&quot;)</code></pre>
</div>
